# 计算机组成

####

## CPU组成

### **计算机基础构成**

* 外设
  * 输入设备
  * 输出设备
  * 辅助存储器（辅存/外存）
* 主机
  * CPU
    * 运算器
    * 控制器
  * 主存储器（主存/内存）

### **线路运输**

* 总线：一条总线同一时刻仅允许一个设备发送，但允许多个设备接受
* 数据总线
  * 概念：在 CPU 与 RAM 之间来回传送需要处理或是需要存储的数据
  * 路线：
    * 输入设备->主存储器
    * 辅助存储器 <-> 主存储器
    * 主存储器 -> 输出设备
    * 运算器 <-> 主存储器
* 控制总线
  * 概念：将微处理器控制单元的信号，传送到周边设备
  * 路线：
    * 控制器 -> 运算器
    * 控制器 -> 主存储器
    * 控制器 -> 辅助存储器
    * 控制器 -> 输出设备
* 地址总线
  * 概念：用来指定在 RAM 之中储存的数据的地址
  * 路线：
    * 控制器 <-> 主存储器

### 运算器和控制器

**运算器**

* 算数逻辑单元 ALU: 数据的算数运算和逻辑运算
* 累加寄存器 AC:通用寄存器，为 ALU 提供一个工作区，用在暂存数据
* 数据缓冲寄存器 DR:写内存时，暂存指令或数据
* 状态条件寄存器 PSW:村状态标志与控制标志
* 注意：状态条件寄存器 PSW 归属存在争议，也有将其归为控制器的理论

**控制器**

* 程序计数器 PC:存储下一条要执行指令的地址
* 指令寄存器 IR:存储即将执行的指令
* 指令译码器 ID:对指令中的操作码字段进行分析解释
* 时序部件:提供时序控制信号

## 存储系统

### 层次化存储体系

* 存储结构：CPU（寄存器【存储速率最快、容量最小、成本最高】） -> Cache（按内容存取） -> 内存（RAM、ROM） -> 外存（硬盘、光盘、U 盘【存储速率最慢、容量最大、成本最低】）
  * 局部性存储原理是层次化存储结构的支撑
    * 时间局部性：刚被访问的内容，立即又被访问
    * 空间局部性：刚被访问的内容，临近的空间很快被访问
* 存储结构分类：
  1. 按存储位置：
     * 内存
     * 外存
  2. 按存取方式
     * 按内容存取（Cache）
     * 按地址存取
       * 随机存取存储器（内存）
       * 顺序存取存储器（磁带）
       * 直接存取存储器（磁带）
  3. 按工作方式
     * 随机存取存储器 RAM（内存 DRAM）
     * 只读存储器 ROM（BIOS）

### Cache

* 概念：
  * 在计算机存储系统体系中，Cache 的访问速度最快的层次（在没有寄存器的情况下）
  * 使用 Cache 改善系统性能的依据是程序的局部性原理（时间局部性和空间局部性）
*   Cache 的访问命中率

    > 如果以 h 代表对 Cache 的访问命中率，t1 表示 Cache 的周期时间，t2 表示主存储器周期时间,以读操作为例，使用”Cache + 主存储器“的系统的平均周期为 t3，则: t3 = h\*t1 + (1 - h)\*t2 其中,(1 - h)又称为失效率（未命中率）。
* 映像
  * 概念：地址映像是将主存与 Cache 的存储空间划分为若干大小相同的页（或称为块）
  * 分类：
    * 直接相联映像：硬件电路较简单，但冲突率很高
    * 全相联映像：电路难于设计和实现，只适用于小容量的 Cache，C 冲突率较低
    * 组相联映像：直接相联映像与全相联映像的折中
  *   比较：

      |        | 冲突率（高、中、低） | 电路复杂度（复杂、简单、折中） |
      | :----: | :--------: | :-------------: |
      | 直接相联映像 |      高     |        简单       |
      |  全相联映像 |      低     |        复杂       |
      |  组相联映像 |      中     |        折中       |
  * 注意：主存与 Cache 之间的地址映射由硬件直接完成

### 主存编址计算

* 概念：
  * 字和字长：计算机在存储、传送或操作时，作为一个单元的一组二进制码称为字，一个字中的二进制位的位数称为字长
  * 1B（字节） = 8bit
* 计算相关：
  * 存储单元个数 = 最大地址 - 最小地址 + 1
  * 编制内容：
    * 按字编址：存储体的存储单元是字存储单元，即最小寻址单位是一个字（1bit）
    * 按字节编址：存储体的存储单元是字节存储单元，即最小寻址单位是一个字节（1B）
  * 总容量 = 存储单元个数 \* 编址内容
  *   根据存储器所要求的容量和选定的存储芯片的容量，就可以计算出所需芯片的总数

      > 总片数 = 总容量 / 每片的容量

## 输入输出技术

### 数据传输控制方式

* 程序控制（查询）方式：分为无条件传送和程序查询方式两种。方法简单，硬件开销小，单 I/O 能力不高，严重影像 CPU 的利用率
*   程序中断方式：与程序控制方式相比，中断方式因为 CPU 无需等待而提高了传输请求的响应速度

    > 中断处理过程： 1.CPU 无需等待也不必查询 I/O 状态。 2.当 I/O 系统准备好以后，发出中断请求信号通知 CPU。 3.CPU 接到中断请求后，保存正在执行程序的现场（保存现场），打断的程序当前位置即为断点。 4.（通过中断向量表）转入 I/O 中的服务程序的执行，完成 I/O 系统的数据交换 5.返回被打断的程序继续执行（恢复现场）
*   DMA 方式：DMA 方式是为了在主存和外设之间实现高速、批量数据交换而设置的。DMA 方式比程序控制方式与中断方式都高效

    > DMAC 向总线裁决逻辑提出总线请求；CPU 执行完当前总线周期即可释放总线控制权。此时 DMA 响应，通过 DMAC 通知 I/O 接口开始 DMA 传输
* 通道方式
* I/O 处理机

## 总线系统

未完待续。。。
